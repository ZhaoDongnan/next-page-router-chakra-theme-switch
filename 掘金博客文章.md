# Next.js Page Router + Chakra UI å®ç°ä¼˜é›…çš„ä¸»é¢˜åˆ‡æ¢ ğŸŒ“

> ä»0åˆ°1æ­å»ºNext.jsä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼Œè®©ä½ çš„åº”ç”¨æ›´å…·ä¸ªæ€§åŒ–ä½“éªŒ

## ğŸ“Œ å¼•è¨€

ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½å·²ç»æˆä¸ºç°ä»£Webåº”ç”¨çš„æ ‡é…ï¼Œå®ƒä¸ä»…èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼Œè¿˜èƒ½æ»¡è¶³ä¸åŒç”¨æˆ·åœ¨ä¸åŒåœºæ™¯ä¸‹çš„ä½¿ç”¨éœ€æ±‚ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»0åˆ°1ä½¿ç”¨Next.js Page Routerå’ŒChakra UIå®ç°ä¸€ä¸ªä¼˜é›…çš„ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ
- **Next.js 16** (Page Router)
- **Chakra UI 3**
- **next-themes**
- **TypeScript**

### æœ€ç»ˆæ•ˆæœ
- ğŸŒ æµ…è‰²æ¨¡å¼å’Œ ğŸŒ™ æ·±è‰²æ¨¡å¼æ— ç¼åˆ‡æ¢
- ä¸»é¢˜çŠ¶æ€æŒä¹…åŒ–å­˜å‚¨
- æ”¯æŒç³»ç»Ÿä¸»é¢˜æ£€æµ‹
- ä¼˜é›…çš„å›¾æ ‡åŠ¨ç”»

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–Next.jsé¡¹ç›®

é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨å®˜æ–¹çš„`create-next-app`å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ªNext.jsé¡¹ç›®ï¼š

```bash
npx create-next-app@latest next-page-router-chakra-theme-switch --typescript --app-router false
cd next-page-router-chakra-theme-switch
```

> æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨`--app-router false`æ¥æ˜ç¡®ä½¿ç”¨Page Routerï¼Œè€Œä¸æ˜¯App Router

åˆå§‹åŒ–å®Œæˆåï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”‚   â”œâ”€â”€ _document.tsx
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â””â”€â”€ styles/
â”œâ”€â”€ public/
â”œâ”€â”€ package.json
â””â”€â”€ next.config.ts
```

## ğŸ“¦ ç¬¬äºŒæ­¥ï¼šå®‰è£…å¿…è¦çš„ä¾èµ–

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…Chakra UIã€next-themeså’Œå›¾æ ‡åº“ï¼š

```bash
npm install @chakra-ui/react @emotion/react next-themes react-icons
```

- **@chakra-ui/react**ï¼šæä¾›UIç»„ä»¶å’Œä¸»é¢˜ç³»ç»Ÿ
- **@emotion/react**ï¼šChakra UIçš„ä¾èµ–ï¼Œç”¨äºæ ·å¼å¤„ç†
- **next-themes**ï¼šNext.jsä¸“ç”¨çš„ä¸»é¢˜ç®¡ç†åº“
- **react-icons**ï¼šæä¾›å›¾æ ‡æ”¯æŒ

## âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®Chakra UIå’Œnext-themes

### é…ç½®_app.tsx

ä¿®æ”¹`src/pages/_app.tsx`æ–‡ä»¶ï¼Œæ·»åŠ Chakra UIå’Œnext-themesçš„æä¾›è€…ï¼š

```tsx
// src/pages/_app.tsx
import { ChakraProvider, defaultSystem } from "@chakra-ui/react"
import { ThemeProvider } from "next-themes"
import { AppProps } from "next/app"

export default function App({ Component, pageProps }: AppProps) {
  return (
    <ChakraProvider value={defaultSystem}>
      <ThemeProvider attribute="class" disableTransitionOnChange>
        <Component {...pageProps} />
      </ThemeProvider>
    </ChakraProvider>
  )
}
```

è¿™é‡Œæˆ‘ä»¬é…ç½®äº†ï¼š
- `ChakraProvider`ï¼šChakra UIçš„æ ¹æä¾›è€…ï¼Œä½¿ç”¨é»˜è®¤ä¸»é¢˜ç³»ç»Ÿ
- `ThemeProvider`ï¼šnext-themesçš„ä¸»é¢˜æä¾›è€…ï¼Œä½¿ç”¨`class`å±æ€§æ¥åˆ‡æ¢ä¸»é¢˜
- `disableTransitionOnChange`ï¼šç¦ç”¨ä¸»é¢˜åˆ‡æ¢æ—¶çš„è¿‡æ¸¡æ•ˆæœï¼Œé¿å…é—ªçƒ

## ğŸ› ï¸ ç¬¬å››æ­¥ï¼šå®ç°ä¸»é¢˜åˆ‡æ¢ç»„ä»¶

ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ä¸»é¢˜åˆ‡æ¢ç»„ä»¶æ–‡ä»¶`src/components/color-mode.tsx`ï¼š

```tsx
// src/components/color-mode.tsx
"use client"

import type { IconButtonProps } from "@chakra-ui/react"
import { ClientOnly, IconButton, Skeleton } from "@chakra-ui/react"
import { useTheme } from "next-themes"
import * as React from "react"
import { LuMoon, LuSun } from "react-icons/lu"

export type ColorMode = "light" | "dark"

// è‡ªå®šä¹‰Hookï¼šè·å–å’Œæ§åˆ¶ä¸»é¢˜
export function useColorMode() {
  const { resolvedTheme, setTheme, forcedTheme } = useTheme()
  // è·å–å½“å‰ä¸»é¢˜ï¼Œå¦‚æœæœ‰å¼ºåˆ¶ä¸»é¢˜åˆ™ä½¿ç”¨å¼ºåˆ¶ä¸»é¢˜
  const colorMode = forcedTheme || resolvedTheme
  
  // åˆ‡æ¢ä¸»é¢˜çš„å‡½æ•°
  const toggleColorMode = () => {
    setTheme(resolvedTheme === "dark" ? "light" : "dark")
  }
  
  return {
    colorMode: colorMode as ColorMode,
    setColorMode: setTheme, // è®¾ç½®ä¸»é¢˜
    toggleColorMode,       // åˆ‡æ¢ä¸»é¢˜
  }
}

// æ ¹æ®ä¸»é¢˜æ˜¾ç¤ºä¸åŒçš„å›¾æ ‡
export function ColorModeIcon() {
  const { colorMode } = useColorMode()
  // æµ…è‰²æ¨¡å¼æ˜¾ç¤ºå¤ªé˜³å›¾æ ‡ï¼Œæ·±è‰²æ¨¡å¼æ˜¾ç¤ºæœˆäº®å›¾æ ‡
  return colorMode === "dark" ? <LuMoon /> : <LuSun /> 
}

// ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ç»„ä»¶
export const ColorModeButton = React.forwardRef<
  HTMLButtonElement,
  IconButtonProps
>(function ColorModeButton(props, ref) {
  const { toggleColorMode } = useColorMode()
  
  return (
    <ClientOnly fallback={<Skeleton boxSize="9" />}>
      <IconButton
        onClick={toggleColorMode} // ç‚¹å‡»æ—¶åˆ‡æ¢ä¸»é¢˜
        variant="ghost"           // ä½¿ç”¨é€æ˜èƒŒæ™¯çš„æŒ‰é’®æ ·å¼
        aria-label="åˆ‡æ¢é¢œè‰²æ¨¡å¼"
        size="sm"
        ref={ref}
        {...props}
        css={{
          _icon: {
            width: "5",
            height: "5",
          },
        }}
      >
        <ColorModeIcon /> // æ˜¾ç¤ºä¸»é¢˜å›¾æ ‡
      </IconButton>
    </ClientOnly>
  )
})

// æ ¹æ®ä¸»é¢˜è¿”å›ä¸åŒå€¼çš„Hook
export function useColorModeValue<T>(light: T, dark: T) {
  const { colorMode } = useColorMode()
  return colorMode === "dark" ? dark : light
}
```

### ä»£ç è§£æ

1. **"use client"**ï¼šæ ‡è®°è¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶

2. **useColorMode Hook**ï¼š
   - ä½¿ç”¨next-themesçš„useTheme Hookè·å–ä¸»é¢˜çŠ¶æ€
   - å®ç°äº†è·å–å½“å‰ä¸»é¢˜ã€è®¾ç½®ä¸»é¢˜å’Œåˆ‡æ¢ä¸»é¢˜çš„åŠŸèƒ½

3. **ColorModeIconç»„ä»¶**ï¼š
   - æ ¹æ®å½“å‰ä¸»é¢˜æ˜¾ç¤ºå¤ªé˜³æˆ–æœˆäº®å›¾æ ‡
   - ä½¿ç”¨äº†react-iconsåº“ä¸­çš„LuSunå’ŒLuMoonå›¾æ ‡

4. **ColorModeButtonç»„ä»¶**ï¼š
   - ä½¿ç”¨Chakra UIçš„IconButtonç»„ä»¶
   - ç‚¹å‡»æ—¶è§¦å‘toggleColorModeå‡½æ•°
   - åŒ…å«åŠ è½½çŠ¶æ€çš„éª¨æ¶å±

5. **useColorModeValue Hook**ï¼š
   - ä¸€ä¸ªä¾¿æ·çš„Hookï¼Œæ ¹æ®å½“å‰ä¸»é¢˜è¿”å›ä¸åŒçš„å€¼

## ğŸ“„ ç¬¬äº”æ­¥ï¼šåœ¨é¡µé¢ä¸­ä½¿ç”¨ä¸»é¢˜åˆ‡æ¢

ç°åœ¨æˆ‘ä»¬åœ¨é¦–é¡µ`src/pages/index.tsx`ä¸­ä½¿ç”¨ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ï¼š

```tsx
// src/pages/index.tsx
import { ColorModeButton } from "@/components/color-mode"
import { Box, Text, VStack, Heading } from "@chakra-ui/react"
import { useColorModeValue } from "@/components/color-mode"

export default function Page() {
  // æ ¹æ®ä¸»é¢˜è¿”å›ä¸åŒçš„æ–‡æœ¬é¢œè‰²
  const textColor = useColorModeValue("gray.800", "gray.200")
  // æ ¹æ®ä¸»é¢˜è¿”å›ä¸åŒçš„èƒŒæ™¯é¢œè‰²
  const bgColor = useColorModeValue("white", "gray.900")
  // æ ¹æ®ä¸»é¢˜è¿”å›ä¸åŒçš„å¼ºè°ƒè‰²
  const accentColor = useColorModeValue("blue.600", "blue.400")
  
  return (
    <Box 
      minHeight="100vh" 
      padding="4rem" 
      backgroundColor={bgColor}
      color={textColor}
    >
      {/* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */}
      <Box position="absolute" top="4" right="4">
        <ColorModeButton />
      </Box>
      
      {/* é¡µé¢å†…å®¹ */}
      <VStack spacing="4" alignItems="center" justifyContent="center" minHeight="100vh">
        <Heading as="h1" size="2xl" color={accentColor}>
          Next.js ä¸»é¢˜åˆ‡æ¢ç¤ºä¾‹
        </Heading>
        <Text fontSize="xl">
          å½“å‰ä½¿ç”¨ {useColorModeValue("æµ…è‰²", "æ·±è‰²")} æ¨¡å¼
        </Text>
        <Text>
          ç‚¹å‡»å³ä¸Šè§’çš„å›¾æ ‡åˆ‡æ¢ä¸»é¢˜
        </Text>
      </VStack>
    </Box>
  )
}
```

è¿™é‡Œæˆ‘ä»¬ï¼š
- ä½¿ç”¨`ColorModeButton`ç»„ä»¶æ·»åŠ ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
- ä½¿ç”¨`useColorModeValue` Hookæ ¹æ®ä¸»é¢˜è¿”å›ä¸åŒçš„é¢œè‰²å€¼
- åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„é¡µé¢å¸ƒå±€æ¥å±•ç¤ºä¸»é¢˜æ•ˆæœ

## ğŸ§ª ç¬¬å…­æ­¥ï¼šæµ‹è¯•å’Œä¼˜åŒ–

### è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€`http://localhost:3000`ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- ä¸€ä¸ªå¸¦æœ‰ä¸»é¢˜åˆ‡æ¢æŒ‰é’®çš„é¡µé¢
- ç‚¹å‡»æŒ‰é’®å¯ä»¥åœ¨æµ…è‰²å’Œæ·±è‰²æ¨¡å¼ä¹‹é—´åˆ‡æ¢
- ä¸»é¢˜çŠ¶æ€ä¼šè‡ªåŠ¨ä¿å­˜åˆ°localStorage

### ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ è¿‡æ¸¡æ•ˆæœ**ï¼šå¯ä»¥ä¸ºä¸»é¢˜åˆ‡æ¢æ·»åŠ å¹³æ»‘çš„è¿‡æ¸¡åŠ¨ç”»
2. **è‡ªå®šä¹‰ä¸»é¢˜**ï¼šå¯ä»¥æ‰©å±•Chakra UIçš„é»˜è®¤ä¸»é¢˜
3. **æ·»åŠ æ›´å¤šä¸»é¢˜**ï¼šé™¤äº†æµ…è‰²å’Œæ·±è‰²æ¨¡å¼ï¼Œè¿˜å¯ä»¥æ·»åŠ æ›´å¤šä¸»é¢˜é€‰é¡¹

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹è§£æ

### next-themesçš„å·¥ä½œåŸç†

next-themesé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ä¸»é¢˜ç®¡ç†ï¼š
- åœ¨å®¢æˆ·ç«¯ï¼šä½¿ç”¨localStorageå­˜å‚¨ä¸»é¢˜åå¥½
- åœ¨æœåŠ¡å™¨ç«¯ï¼šæ£€æµ‹ç³»ç»Ÿä¸»é¢˜å¹¶æ³¨å…¥ç›¸åº”çš„CSSç±»
- é€šè¿‡React Context APIåœ¨ç»„ä»¶æ ‘ä¸­å…±äº«ä¸»é¢˜çŠ¶æ€

### Chakra UIä¸ä¸»é¢˜çš„é›†æˆ

Chakra UIçš„ä¸»é¢˜ç³»ç»Ÿä¸next-themeså®Œç¾å…¼å®¹ï¼š
- æä¾›äº†ä¸°å¯Œçš„ä¸»é¢˜å˜é‡
- æ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜
- ç»„ä»¶ä¼šè‡ªåŠ¨å“åº”ä¸»é¢˜å˜åŒ–

### å®¢æˆ·ç«¯ç»„ä»¶ä¸æœåŠ¡ç«¯æ¸²æŸ“

ç”±äºä¸»é¢˜åˆ‡æ¢æ˜¯å®¢æˆ·ç«¯åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ï¼š
- `"use client"`æŒ‡ä»¤æ ‡è®°å®¢æˆ·ç«¯ç»„ä»¶
- `ClientOnly`ç»„ä»¶ç¡®ä¿åœ¨å®¢æˆ·ç«¯æ¸²æŸ“
- éª¨æ¶å±å¤„ç†åŠ è½½çŠ¶æ€

## ğŸ æ€»ç»“

é€šè¿‡æœ¬æ–‡çš„æ•™ç¨‹ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ä¸€ä¸ªä¼˜é›…çš„Next.jsä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼š

1. åˆå§‹åŒ–äº†Next.js Page Routeré¡¹ç›®
2. é›†æˆäº†Chakra UIå’Œnext-themes
3. å®ç°äº†å®Œæ•´çš„ä¸»é¢˜åˆ‡æ¢ç»„ä»¶
4. åœ¨é¡µé¢ä¸­ä½¿ç”¨ä¸»é¢˜åŠŸèƒ½

è¿™ä¸ªå®ç°å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- âœ… æ”¯æŒæµ…è‰²/æ·±è‰²æ¨¡å¼åˆ‡æ¢
- âœ… ä¸»é¢˜çŠ¶æ€æŒä¹…åŒ–
- âœ… å“åº”ç³»ç»Ÿä¸»é¢˜åå¥½
- âœ… ä¼˜é›…çš„å›¾æ ‡æ˜¾ç¤º
- âœ… è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè®©ä½ èƒ½å¤Ÿè½»æ¾åœ°ä¸ºè‡ªå·±çš„Next.jsåº”ç”¨æ·»åŠ ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼

## ğŸ“ é¡¹ç›®åœ°å€

æœ¬æ–‡çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ°ï¼š
[https://github.com/ZhaoDongnan/next-page-router-chakra-theme-switch](https://github.com/ZhaoDongnan/next-page-router-chakra-theme-switch)

---

å¦‚æœè§‰å¾—æœ¬æ–‡æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è¯„è®ºå’Œåˆ†äº«ï¼ğŸ˜Š